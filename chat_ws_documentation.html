<html>
<head>
<title>Chaty WS Documentation</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1" />
<meta property="og:description" content="Chaty WS Documentation" />
<meta property="og:title" content="Chaty WS Documentation" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Chaty WS Documentation" />
<style>* {
	margin: 0;
	padding: 0;
}
body {
	margin: 32px;
	font-size: 16px;
	font-family: Verdana, Arial, sans-serif;
}
p {
	text-align: justify;
	font-family: Times New Roman, serif;
	line-height: 1.3em;
	font-size: 1.2em;
}
.endpoint {
	margin-top: 32px;
	border: 1px solid black;
	padding: 16px;
}
.endpoint > .title {
	font-weight: bold;
	font-size: 1.1em;
}
.endpoint > .section {
	margin-top: 16px;
}
.endpoint > .section > .title {
	font-weight: bold;
	margin-bottom: 16px;
}
.code {
	font-family: courier;
	color: white;
	background-color: #444444;
	padding: 16px;
	border-radius: 8px;
}</style>
</head>
<body>

<div class="endpoint">
	<div class="title">Introduction</div>
	<div class="title">Audience</div>
	<div class="description">
		<p>This specification is primarily intended for individuals and groups who will implement clients connecting to Chaty backend. </p>
	</div>
	<div class="section">
		<div class="title">Requirements</div>
		<div class="description">
			<p>To implement the interface of Chaty, the following requirements must be met:</p>
			<p>- Working knowledge of WebSocket Protocol.</p>
			<p>- Working knowledge of HTTP.</p>
			<p>- Working knowledge of JSON.</p>
		</div>
	</div>
	<div class="section">
		<div class="title">Message format</div>
		<div class="description">
			<p>There are two types of messages being used:</p>
		</div>
	</div>
	<div class="section">
		<div class="title">Command message</div>
		<div class="description">
			<p>The command message is used for command related calls such as creating a channel, fetching list of channels of the current user, etc.</p>
		</div>
	</div>
	<div class="section">
		<div class="title">Data message</div>
		<div class="description">
			<p>The data message serves as the chat message which being sent or received from other clients.</p>
			</p>The message is formatted in a JSON object with two keys: 'messageType' and 'data'. The 'messageType' key can only have a value between 1 or 2. The 1 indicates that it is a command message while the 2 indicates that it is a data message. The value for the 'data' key is a JSON object. Please see below for the sample message format:</p>
		</div>
		<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "create_channel",
		"recipients" : [
			"19366d4a383f6433fb8fbc35a663fb42",
			"18434697e6cc2a36b059455a104f4607"
		]
	}
}
		</pre></div>
	</div>
	<div class="section">
		<div class="title">Authentication</div>
		<div class="description">
			<p>The authentication process is made in two parts: establishing a connection and sending auth data.</p>
		</div>
	</div>
	<div class="section">
		<div class="title">Establishing a WebSocket connectio</div>
		<div class="description">
			<p>The authentication process is made in two parts: establishing a connection and sending auth data.To establish a WebSocket connection, perform a WebSocket handshake request against the server. Below is a sample request:</p>
		</div>
		<div class="code"><pre>
GET {endpoint} HTTP/1.1
Host: {host_address}
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: {key}
Sec-WebSocket-Version: 13
		</pre></div>
	</div>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Sending auth data</div>
	</div>
	<div class="section">
		<div class="description">
			<p>Once the WebSocket connection is established, send the session ID as a WebSocket message within 5 seconds. The session ID will be the auth data needed for this authentication process. The auth data format depends on how the authentication server parse it, the Chaty server would just pass it to the authentication server as it is given by the client. Below is a sample auth data that contains only the plain session ID:</p>
		</div>
	</div>
	<div class="code"><pre>
811A90E1C8E86C7B4C0EEF5B2C0BF0EC1B19C4B1B5A242E6455BE93787CB473CB7BC9B0FDEB960D00D5C6881C2094DD63C5C900CE9057255E2A4E271FC25FEF1
	</pre></div>
	<p>When the server is done with auth data verification and that everything is valid, the authentication process is now complete and the server will respond with a message command with the command 'authentication_acknowledged' and the user ID of the current user connected. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "authentication_acknowledged",
		"userId" : "e43df02198b6b779f1fbb61579b0156as"
	}
}
	</pre></div>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Retrieving list of channels</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To retrieve the list of channels of the current connected user, send a command message with the command 'get_channels'. The limit per page are 20 items. Below is the sample command message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "get_channels",
		"page" : 1
	}
}
	</pre></div>
	<p>After sending the command message, you will receive a command message that contains the channels as a response.It contains the most recent message and list of recipients userId. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "get_channels",
		"channels" : [
			{
				"channelId" : "703822ab0147c964a3e82b3afae33e1f",
				"recipients" : [
					"19366d4a383f6433fb8fbc35a663fb42",
					"18434697e6cc2a36b059455a104f4607"
				],
				"message" : {
					"messageId" : "f715e83527cc2eaa1dd442ef930ee10f",
					"channelId" : "703822ab0147c964a3e82b3afae33e1f",
					"creatorUserId" : "19366d4a383f6433fb8fbc35a663fb42",
					"message" : "Hi!",
					"timeStampCreated" : 1533485852,
					"timeStampLastUpdated" : 1533485852,
					"messageIndex" : 0
				},
				"unreadCount" : 0,
				"channelCreatorUserId" : "19366d4a383f6433fb8fbc35a663fb42",
				"title" : "Running Group",
				"externalId" : "e2ae6abd3098acdcbba5b210fc12bdb5",
				"timeStampCreated" : "1533483583",
				"timeStampLastUpdated" : "1533485852"
			},
			{
				"channelId" : "6d6387662d94ee9e557bc1273b42db31",
				"recipients" : [
					"ca68ede2c1ae9cf0953f329a37e17426",
					"18434697e6cc2a36b059455a104f4607"
				],
				"message" : {
					"messageId" : "e532ccb977885e15f3c039a20d31a49e",
					"channelId" : "6d6387662d94ee9e557bc1273b42db31",
					"creatorUserId" : "18434697e6cc2a36b059455a104f4607",
					"message" : "Hello!",
					"timeStampCreated" : 1533486852,
					"timeStampLastUpdated" : 1533486852,
					"messageIndex" : 2
				},
				"unreadCount" : 0,
				"channelCreatorUserId" : "18434697e6cc2a36b059455a104f4607",
				"title" : null,
				"externalId" : null,
				"timeStampCreated" : "1533383583",
				"timeStampLastUpdated" : "1533486852"
			}
		]
	}
}
	</pre></div>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Retrieving the messages of a specific channel</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To retrieve the messages of a specific channel of the current user, send a command message with the command 'get_messages'. You also need to specify one of the following parameters:</p>
			<p>'channelId' - This is the unique ID for a channel and is the recommended parameter to specify when retrieving messages.</p>
			<p>'externalId' - This is a unique ID that is used as a reference to an external ID which represents an external entity. Use this parameter as an alternative to the channel ID.</p>
			<p>'recipients' - This is a JSON array of user IDs of the recipients of the channel you are referring to. You can use this to retrieve the messages as an alternative to channel ID or external ID. Note that this is only applicable for channels with only two users and has no external ID that is associated to an external entity.</p>
			<p>You can specify the three parameters above, but only one of them will be used for retrieving messages. Below is the sample command message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "get_messages",
		"externalId" : "e2ae6abd3098acdcbba5b210fc12bdb5",
		"channelId" : "703822ab0147c964a3e82b3afae33e1f",
		"recipients" : [
			"19366d4a383f6433fb8fbc35a663fb42",
			"18434697e6cc2a36b059455a104f4607"
		],
	}
}
	</pre></div>
	<p>After sending the command message, you will receive a command message that contains the messages of the specified channel as a response. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "get_messages",
		"channelCreatorUserId" : "19366d4a383f6433fb8fbc35a663fb42",
		"title" : "Running Group",
		"channelId" : "703822ab0147c964a3e82b3afae33e1f",
		"recipients" : [
			"19366d4a383f6433fb8fbc35a663fb42",
			"18434697e6cc2a36b059455a104f4607"
		],
		"externalId" : "e2ae6abd3098acdcbba5b210fc12bdb5",
		"messages" : [
			{
				"messageId" : "f715e83527cc2eaa1dd442ef930ee10f",
				"channelId" : "703822ab0147c964a3e82b3afae33e1f",
				"creatorUserId" : "19366d4a383f6433fb8fbc35a663fb42",
				"message" : "Hi!",
				"timeStampCreated" : 1533485852,
				"timeStampLastUpdated" : 1533485852,
				"messageIndex" : 0
			}
		]
	}
}
	</pre></div>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Leaving a channel</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To leave a channel, send a command message with the command 'leave_channel' and the channel ID of the channel you want to leave. Below is the sample command message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "leave_channel",
		"channelId" : "b070f50f12279d3f35342762d5094071"
	}
}
	</pre></div>
	<p>	After sending the command message and that everything is ok, you will receive a command message as a response stating the status of the request, if the status is ok, then you have successfully left the channel. Below is the sample response: </p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "leave_channel",
		"channelId" : "b070f50f12279d3f35342762d5094071",
		"status" : "ok"
	}
}
	</pre></div>
	<p>If the operation isn't successful, the status will be an error with the error code and its error message. Below is the sample error response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "leave_channel",
		"channelId" : "b070f50f12279d3f35342762d5094070",
		"status" : "error",
		"code" : "invalid_channel_id",
		"message" : "Invalid channel id"
	}
}
	</pre></div>
	<p>NOTE: You can't leave a channel with an external ID that is associated to an external entity, instead, you need to leave that external entity using the appropriate API call. You can't also leave a channel which has only two users left in it or a channel you're not part of.</p>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Deleting a channel</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To delete a channel, send a command message with the command 'delete_channel'. Below is the sample command message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_channel",
		"channelId" : "d3eacb238a49b058f893de8054dec295"
	}
}
	</pre></div>
	<p>After sending the command message and that everything is ok, you will receive a command message as a response with the status of ok. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_channel",
		"channelId" : "d3eacb238a49b058f893de8054dec295",
		"status" : "ok"
	}
}
	</pre></div>
	<p>If the operation isn't successful, the status will be an error with the error code and its error message. Below is the sample error response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_channel",
		"channelId" : "d3eacb238a49b058f893de8054dec296",
		"status" : "error",
		"code" : "not_allowed",
		"message" : "Not allowed"
	}
}
	</pre></div>
	<p>NOTE: You can't delete a channel with an external ID that is associated to an external entity, instead, you need to delete that external entity using the appropriate API call. You can't also delete a channel which is created by other users.</p>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Updating recipients of a specific channel</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To update the recipients or users that are part of a specific channel, send a command message with the command 'update_recipients', the channel ID of the channel you are referring to, and the list of the updated recipients. Below is the sample command message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "update_recipients",
		"channelId" : "5a136ed247586812a138efcc1d81848f",
		"recipients" : [
			"19366d4a383f6433fb8fbc35a663fb42",
			"18434697e6cc2a36b059455a104f4607",
			"91f14983868781b4ed9d758e06d28d0a"
		]
	}
}
	</pre></div>
	<p>After sending the command message and that everything is ok, you will receive a command message as a response with the status of ok. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "update_recipients",
		"channelId" : "5a136ed247586812a138efcc1d81848f",
		"status" : "ok"
	}
}
	</pre></div>
	<p>If the operation isn't successful, the status will be an error with the error code and its error message. Below is the sample error response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "update_recipients",
		"channelId" : "5a136ed247586812a138efcc1d81848c",
		"status" : "error",
		"code" : "invalid_channel_id",
		"message" : "Invalid channel id"
	}
}
	</pre></div>
	<p>NOTE: You can't update the recipients of a channel with an external ID that is associated to an external entity. You can't also update the recipients of a channel which you are not part of.</p>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Deleting one or more messages of a specific channel</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To delete one or more messages of a specific channel, send a command message with the command 'delete_messages', channel ID of the channel you are referring to, and the list of message IDs that you want to delete. Below is the sample message command:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_messages",
		"channelId" : "64afeba3f7b0ceccddb072cda888f713",
		"messages" : [
			"cd518db21867c355766fb86734084a6f",
			"a14dd64babb991a688f0dbc931dc86fa",
			"dc509ca3a76190d0b915029d3f7526be",
			"26637e91aebce645dd263bf68c801ffe",
			"61dec52b7f44f8eb2f284401de40d5a6"
		]
	}
}
	</pre></div>
	<p>After sending the command message and that everything is ok, you will receive a command message as a response with the status of ok. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_messages",
		"channelId" : "64afeba3f7b0ceccddb072cda888f713",
		"status" : "ok"
	}
}
	</pre></div>
	<p>If the operation isn't successful, the status will be an error with the error code and its error message. Below is the sample error response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_messages",
		"channelId" : "64afeba3f7b0ceccddb072cda888f713",
		"status" : "error",
		"code" : "not_allowed",
		"message" : "Cannot delete messages that don't belong to you."
	}
}
	</pre></div>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Deleting specific message</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To delete specific message, send a command message with the command 'delete_message'. The message ID is required. Below is the sample message command:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_message",
		"messageId" : "64afeba3f7b0ceccddb072cda888f713",
	}
}
	</pre></div>
	<p>After sending the command message and that everything is ok, you will receive a command message as a response with the status of ok. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_message",
		"messageId" : "64afeba3f7b0ceccddb072cda888f713",
		"status" : "ok"
	}
}
	</pre></div>
	<p>If the operation isn't successful, the status will be an error with the error code and its error message. Below is the sample error response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "delete_message",
		"messageId" : "64afeba3f7b0ceccddb072cda888f713",
		"status" : "error",
		"code" : "invalid_message_id",
		"message" : "Invalid message id."
	}
}
	</pre></div>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Updating specific message</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To update specific message, send a command message with the command 'update_message'. The message ID is required. Below is the sample message command:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "update_message",
		"messageId" : "64afeba3f7b0ceccddb072cda888f713",
		"message" : "This is my new message"
	}
}
	</pre></div>
	<p>After sending the command message and that everything is ok, you will receive a command message as a response with the status of ok. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "update_message",
		"message" : {
			"messageId" : "64afeba3f7b0ceccddb072cda888f713",
			"channelId" : "703822ab0147c964a3e82b3afae33e1f",
			"creatorUserId" : "19366d4a383f6433fb8fbc35a663fb42",
			"message" : "This is my new message",
			"timeStampCreated" : 1533485852,
			"timeStampLastUpdated" : 1533485852,
			"messageIndex" : 0
		},
		"status" : "ok"
	}
}
	</pre></div>
	<p>If the operation isn't successful, the status will be an error with the error code and its error message. Below is the sample error response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "update_message",
		"messageId" : "64afeba3f7b0ceccddb072cda888f713",
		"status" : "error",
		"code" : "internal_error",
		"message" : "Internal error."
	}
}
	</pre></div>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Creating a channel</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To create a new channel, send a command message with the command 'create_channel' and the list of recipients you want to include in this channel. You can also specify the title for this channel. Below is the sample command message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "create_channel",
		"title" : "Road Runners",
		"recipients" : [
			"76d5d5b17a7267c03d3372fd1ded9878",
			"7a777692992d113c7c0904342d99af05",
			"41ee5c575102077803e7faf9c4e3d749",
			"7be31ff7101e4359be524fe1a33d7ce7"
		]
	}
}
	</pre></div>
	<p>After sending the command message, you will receive a command message as a response with the status of ok, the channel ID for the created channel and other details. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "create_channel",
		"title" : "Road Runners",
		"recipients" : [
			"76d5d5b17a7267c03d3372fd1ded9878",
			"7a777692992d113c7c0904342d99af05",
			"41ee5c575102077803e7faf9c4e3d749",
			"7be31ff7101e4359be524fe1a33d7ce7"
		],
		"channelId" : "ff40782b6e36bfb69a39d749f5d83afe",
		"channelCreatorUserId" : "2fe5db57b271c899819b33f7f3b908ae",
		"status" : "ok"
	}
}
	</pre></div>
	<p>NOTE: You need to specify atleast one recipient to create a channel.</p>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Sending a chat message</div>
	</div>
	<div class="section">
		<div class="description">
			<p>To send a chat message, send a data message with the channel ID of the channel you are referring to, the text message, and the send ID. The send ID is used as a reference to the message you sent for you to update its status to 'sent' when the server responds with status ok or 'failed' if something unexpected happened. Below is a sample data message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 2,
	"data" : {
		"channelId" : "69efc908abbde5078c84d56e211b2a83",
		"message" : "Greetings!",
		"sendId" : "2d0c35662e55df6b4116b8a613c75013"
	}
}
	</pre></div>
	<p>After sending the data message and that everything is ok, you will receive a command message as a response with a status of ok, the message ID and the send ID you specified. Below is the sample response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "message_saved",
		"channelId" : "69efc908abbde5078c84d56e211b2a83",
		"message" : "Greetings!",
		"sendId" : "2d0c35662e55df6b4116b8a613c75013",
		"messageId" : "c3f7f2cd6322eab7dbad8d7efad43a01",
		"creatorUserId" : "3ccb1a41fc89136d7dc1474fc8c3950d",
		"channelCreatorUserId" : "3ccb1a41fc89136d7dc1474fc8c3950d",
		"title" : null,
		"externalId" : null,
		"recipients" : [
			"3ccb1a41fc89136d7dc1474fc8c3950d",
			"6aad410bd97814bfebf0b69027564e1a"
		],
		"status" : "ok"
	}
}
	</pre></div>
	<p>If the operation isn't successful, the status will be an error with an error code and its error message. Below is the sample error response:</p>
	<div class="code"><pre>
{
	"messageType" : 1,
	"data" : {
		"command" : "message_saved",
		"channelId" : "69efc908abbde5078c84d56e211b2a80",
		"status" : "error",
		"code" : "invalid_channel_id",
		"message" : "Invalid channel id"
	}
}
	</pre></div>
	<p>NOTE: To send an image attachment, send a data message and specify the image file name with the parameter 'attachmentFileName' and excluding the 'message' parameter. When the response status is ok, use the appropriate API call to upload the actual image file with the channel ID, message ID and image file name. For retrieving the image attachment, use the appropriate API call supplying the channel ID and message ID.</p>
</div>

<div class="endpoint">
	<div class="section">
		<div class="title">Handling incoming chat message</div>
	</div>
	<div class="section">
		<div class="description">
			<p>When someone sends a chat message to you, you will receive it as a data message. Below is a sample data message:</p>
		</div>
	</div>
	<div class="code"><pre>
{
	"messageType" : 2,
	"data" : {
		"channelId" : "69efc908abbde5078c84d56e211b2a83",
		"message" : "Greetings!",
		"messageId" : "c3f7f2cd6322eab7dbad8d7efad43a01",
		"creatorUserId" : "3ccb1a41fc89136d7dc1474fc8c3950d",
		"channelCreatorUserId" : "3ccb1a41fc89136d7dc1474fc8c3950d",
		"title" : null,
		"externalId" : null
	}
}
	</pre></div>
</div>

</body>
</html>